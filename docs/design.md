# 照片视频整理App - 功能与交互设计

## 📋 功能模块划分

### 1. 主配置模块
- 源目录设置
- 目标目录设置
- 整理策略配置

### 2. 文件整理模块
- 照片整理：通过EXIF信息按年/月/日整理
- 视频整理：通过创建时间按年/月/日整理
- 重复文件处理

### 3. 进度展示模块
- 实时处理进度
- 统计信息展示

### 4. 结果汇总模块
- 整理统计报告
- 日志文件生成

---

## 🎨 UI布局与交互设计

### 界面1: 主配置界面

```
╔════════════════════════════════════════════════════════════════════╗
║         📸 照片视频整理工具 v1.0                                     ║
╠════════════════════════════════════════════════════════════════════╣
║                                                                    ║
║  📁 源目录:  D:\Photos\Unsorted                                     ║
║             按 [S] 编辑路径                                         ║
║                                                                    ║
║  📂 目标目录: D:\Photos\Organized                                   ║
║             按 [D] 编辑路径                                         ║
║                                                                    ║
║  ⚙️  整理策略:                                                      ║
║     同文件识别: [F] 文件名  [M] MD5哈希        当前: ● 文件名      ║
║     重复处理:   [1] 跳过    [2] 覆盖  [3] 重命名  当前: ● 跳过     ║
║                                                                    ║
║  ────────────────────────────────────────────────────────────────  ║
║                                                                    ║
║  按 [Enter] 开始整理  |  按 [Q/Esc] 退出程序                        ║
║                                                                    ║
╚════════════════════════════════════════════════════════════════════╝
```

**交互说明：**
- `S` - 弹出输入框编辑源目录路径（Source）
- `D` - 弹出输入框编辑目标目录路径（Destination）
- `F` - 选择"文件名"识别策略（Filename）
- `M` - 选择"MD5"识别策略（MD5）
- `1` - 选择"跳过"重复文件
- `2` - 选择"覆盖"重复文件
- `3` - 选择"重命名"重复文件
- `Enter` - 开始整理
- `Q/Esc` - 退出程序

---

### 界面1.1: 路径输入弹窗

按下 `S` 或 `D` 后弹出：

```
╔════════════════════════════════════════════════════════════════════╗
║  📝 编辑路径                                                        ║
╠════════════════════════════════════════════════════════════════════╣
║                                                                    ║
║  请输入目录路径:                                                    ║
║  ┌──────────────────────────────────────────────────────────────┐ ║
║  │ D:\Photos\Unsorted_                                           │ ║
║  └──────────────────────────────────────────────────────────────┘ ║
║                                                                    ║
║  按 [Enter] 确认  |  按 [Esc] 取消                                 ║
║                                                                    ║
╚════════════════════════════════════════════════════════════════════╝
```

**交互说明：**
- 直接输入路径文本
- `Enter` - 确认保存
- `Esc` - 取消返回

---

### 界面2: 整理进度界面

```
╔════════════════════════════════════════════════════════════════════╗
║         🔄 正在整理文件...                                          ║
╠════════════════════════════════════════════════════════════════════╣
║                                                                    ║
║  当前文件: IMG_20231015_143022.jpg                                 ║
║  目标路径: 2023/10/15/IMG_20231015_143022.jpg                      ║
║                                                                    ║
║  进度: ████████████████████░░░░░░░░░░░░░░░  60% (150/250)         ║
║                                                                    ║
║  ────────────────────────────────────────────────────────────────  ║
║                                                                    ║
║  📊 实时统计:                                                       ║
║     已扫描:  250 个文件                                             ║
║     已处理:  150 个文件                                             ║
║     ├─ 照片: 120 张                                                ║
║     ├─ 视频:  30 个                                                ║
║     ├─ 跳过:  15 个 (重复)                                         ║
║     └─ 错误:   2 个                                                ║
║                                                                    ║
║  ────────────────────────────────────────────────────────────────  ║
║                                                                    ║
║  按 [C/Esc] 取消整理                                                ║
║                                                                    ║
╚════════════════════════════════════════════════════════════════════╝
```

**交互说明：**
- `C/Esc` - 取消当前整理任务（会确认）

---

### 界面3: 完成汇总界面

```
╔════════════════════════════════════════════════════════════════════╗
║         ✅ 整理完成!                                                ║
╠════════════════════════════════════════════════════════════════════╣
║                                                                    ║
║  📊 整理汇总报告                                                    ║
║  ──────────────────────────────────────────────────────────────   ║
║                                                                    ║
║  文件统计:                                                          ║
║     总文件数:      250 个                                           ║
║     ├─ 照片:       200 张                                           ║
║     └─ 视频:        50 个                                           ║
║                                                                    ║
║  处理结果:                                                          ║
║     ✓ 成功整理:    235 个                                           ║
║     ⊘ 跳过(重复):   12 个                                           ║
║     ✗ 失败:          3 个                                           ║
║                                                                    ║
║  性能数据:                                                          ║
║     耗时:          02:35                                            ║
║     处理速度:      1.6 文件/秒                                      ║
║                                                                    ║
║  💾 详细日志: organize_log_20231015_143022.txt                      ║
║                                                                    ║
║  ────────────────────────────────────────────────────────────────  ║
║                                                                    ║
║  按 [R] 重新整理  |  按 [O] 打开目标目录  |  按 [Q/Esc] 退出        ║
║                                                                    ║
╚════════════════════════════════════════════════════════════════════╝
```

**交互说明：**
- `R` - 返回主配置界面重新整理
- `O` - 在文件管理器中打开目标目录
- `Q/Esc` - 退出程序

---

## 🔄 完整交互流程图

```
┌─────────────┐
│   程序启动   │
└──────┬──────┘
       │
       ↓
┌─────────────────────────────────────────┐
│     界面1: 主配置界面                    │
│  ─────────────────────────────           │
│  操作:                                   │
│  • S - 编辑源目录 → 弹出输入框           │
│  • D - 编辑目标目录 → 弹出输入框         │
│  • F - 选择文件名识别                    │
│  • M - 选择MD5识别                       │
│  • 1 - 选择跳过策略                      │
│  • 2 - 选择覆盖策略                      │
│  • 3 - 选择重命名策略                    │
│  • Enter - 开始整理 →                    │
│  • Q/Esc - 退出程序 → 结束               │
└──────────────┬──────────────────────────┘
               │ 按S
               ↓
┌─────────────────────────────────────────┐
│     界面2: 整理进度界面                  │
│  ─────────────────────────────           │
│  显示:                                   │
│  • 当前处理文件                          │
│  • 进度条                                │
│  • 实时统计数据                          │
│                                          │
│  操作:                                   │
│  • C/Esc - 取消整理 → 返回界面1          │
│  • 自动完成 →                            │
└──────────────┬──────────────────────────┘
               │ 完成
               ↓
┌─────────────────────────────────────────┐
│     界面3: 完成汇总界面                  │
│  ─────────────────────────────           │
│  显示:                                   │
│  • 文件统计                              │
│  • 处理结果                              │
│  • 性能数据                              │
│  • 日志文件路径                          │
│                                          │
│  操作:                                   │
│  • R - 重新整理 → 返回界面1              │
│  • O - 打开目标目录                      │
│  • Q/Esc - 退出程序 → 结束               │
└─────────────────────────────────────────┘
```

---

## 📝 整理逻辑说明

### 1. 文件扫描规则
- 递归扫描源目录下所有子目录
- 识别照片文件：`.jpg`, `.jpeg`, `.png`, `.heic`, `.gif`, `.bmp`, `.raw`
- 识别视频文件：`.mp4`, `.mov`, `.avi`, `.mkv`, `.flv`, `.wmv`

### 2. 日期提取规则

**照片：**
1. 优先读取EXIF信息中的 `DateTimeOriginal` (拍摄日期)
2. 如果不存在，读取 `DateTime` (修改日期)
3. 如果仍然失败，使用文件的创建时间

**视频：**
1. 读取文件的创建时间
2. 如果失败，使用文件的修改时间

### 3. 目标路径生成规则
- 格式：`目标目录/YYYY/MM/DD/原文件名`
- 示例：`D:\Photos\Organized\2023\10\15\IMG_001.jpg`

### 4. 重复文件处理规则

**识别策略：**
- **文件名模式**：只比较文件名是否相同
- **MD5模式**：计算文件MD5哈希值比较内容是否相同

**处理策略：**
- **跳过**：保留目标位置原文件，不处理当前文件
- **覆盖**：用当前文件替换目标位置文件
- **重命名**：给当前文件名添加序号，如 `IMG_001(1).jpg`, `IMG_001(2).jpg`

---

## 📊 汇总信息内容

生成的汇总报告包含：

1. **文件统计**
   - 总文件数量
   - 照片数量
   - 视频数量

2. **处理结果**
   - 成功整理数量
   - 跳过数量（重复文件）
   - 失败数量（错误）

3. **性能数据**
   - 总耗时
   - 平均处理速度

4. **详细日志**
   - 保存为文本文件
   - 记录每个文件的处理结果
   - 记录所有错误信息

---

## ⌨️ 快捷键汇总表

| 快捷键 | 功能 | 适用界面 |
|--------|------|----------|
| `S` | 编辑源目录 (Source) | 主配置 |
| `D` | 编辑目标目录 (Destination) | 主配置 |
| `F` | 选择文件名识别 (Filename) | 主配置 |
| `M` | 选择MD5识别 | 主配置 |
| `1` | 选择跳过策略 | 主配置 |
| `2` | 选择覆盖策略 | 主配置 |
| `3` | 选择重命名策略 | 主配置 |
| `Enter` | 开始整理/确认输入 | 主配置/输入框 |
| `C` | 取消整理 (Cancel) | 进度 |
| `R` | 重新整理 (Restart) | 汇总 |
| `O` | 打开目标目录 (Open) | 汇总 |
| `Q` | 退出程序 (Quit) | 主配置/汇总 |
| `Esc` | 退出/取消 | 全局 |
