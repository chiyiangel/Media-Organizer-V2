# 多语言支持 (Internationalization)

本项目支持多语言界面，可根据操作系统语言自动选择合适的语言。

## 支持的语言

- 🇨🇳 **中文** (zh) - 简体中文界面
- 🇺🇸 **English** (en) - English interface

## 语言检测机制

程序启动时会自动检测系统语言：

### Unix/Linux/macOS 系统
按以下优先级检测环境变量：
1. `LANG` 环境变量
2. `LC_ALL` 环境变量  
3. `LC_MESSAGES` 环境变量
4. `LANGUAGE` 环境变量

### Windows 系统
检测 `LANGUAGE` 环境变量

### 语言映射规则
- `zh*` (zh, zh_CN, zh_TW 等) → 中文界面
- `en*` (en, en_US, en_GB 等) → 英文界面
- 其他不支持的语言 → 默认英文界面

## 手动设置语言

如果需要强制使用特定语言，可以设置环境变量：

### 设置为中文
```bash
# Linux/macOS
export LANG=zh_CN.UTF-8

# Windows (PowerShell)
$env:LANG = "zh_CN.UTF-8"

# Windows (Command Prompt)
set LANG=zh_CN.UTF-8
```

### 设置为英文
```bash
# Linux/macOS
export LANG=en_US.UTF-8

# Windows (PowerShell)
$env:LANG = "en_US.UTF-8"

# Windows (Command Prompt)  
set LANG=en_US.UTF-8
```

## 技术实现

### 架构概览
```
internal/i18n/
├── localizer.go     # 语言检测和翻译核心逻辑
├── messages.go      # 所有语言的文本资源
└── localizer_test.go # 单元测试
```

### 核心API

```go
// 获取全局本地化实例
localizer := i18n.GetLocalizer()

// 简单翻译
text := i18n.T("app.title")

// 带参数的翻译
text := i18n.Tf("error.extract_date", errorMsg)

// 设置语言
i18n.SetLanguage(i18n.LanguageChinese)

// 获取当前语言
current := i18n.GetLanguage()
```

### 添加新语言

1. 在 `internal/i18n/localizer.go` 中添加语言常量：
```go
const (
    LanguageChinese Language = "zh"
    LanguageEnglish Language = "en"
    LanguageJapanese Language = "ja" // 新增日语
)
```

2. 在 `internal/i18n/messages.go` 中添加翻译资源：
```go
l.messages = map[Language]map[string]string{
    // ... 现有语言
    LanguageJapanese: {
        "app.title": "📸 写真・動画整理ツール v1.0",
        // ... 其他翻译
    },
}
```

3. 在 `parseLanguageCode()` 方法中添加检测逻辑：
```go
switch {
case strings.HasPrefix(mainLang, "ja"): // 日语
    return string(LanguageJapanese)
}
```

## 测试多语言功能

运行单元测试：
```bash
go test ./internal/i18n/
```

手动测试不同语言：
```bash
# 测试中文
LANG=zh_CN.UTF-8 ./build/media-organizer

# 测试英文  
LANG=en_US.UTF-8 ./build/media-organizer
```

## 使用示例

### 界面文本对比

#### 中文界面
```
📸 照片视频整理工具 v1.0

📁 源目录: 未设置
           按 [S] 编辑路径

📂 目标目录: 未设置  
           按 [D] 编辑路径

⚙️ 整理策略:
    同文件识别: [F] 文件名 ●  [M] MD5哈希  
    重复处理:   [1] 跳过 ●  [2] 覆盖   [3] 重命名  

按 [Enter] 开始整理  |  按 [Q/Esc] 退出程序
```

#### English Interface
```
📸 Photo Video Organizer v1.0

📁 Source Directory: Not Set
           Press [S] to edit path

📂 Target Directory: Not Set
           Press [D] to edit path

⚙️ Organization Strategy:
    File Detection: [F] Filename ●  [M] MD5 Hash  
    Duplicate Action: [1] Skip ●  [2] Overwrite   [3] Rename  

Press [Enter] to start  |  Press [Q/Esc] to quit
```

## 故障排除

### 语言没有正确检测
1. 检查环境变量设置：
```bash
echo $LANG
echo $LC_ALL
```

2. 检查程序启动时的语言检测日志

### 某些文本仍显示为英文
1. 确认该文本键是否已添加到对应语言的翻译资源中
2. 检查是否使用了 `i18n.T()` 或 `i18n.Tf()` 函数

### 添加新翻译
参考现有的翻译键名规范，在 `messages.go` 中添加对应语言的翻译条目。